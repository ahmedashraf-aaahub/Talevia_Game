<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Talevia Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø£Ø·ÙØ§Ù„</title>
  <style>
    * {box-sizing:border-box;}
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding:0;
      background: linear-gradient(135deg, #111 0%, #1a1a1a 100%);
      color: #FF9740;
      direction: rtl;
      min-height:100vh;
    }
    header {
      background: linear-gradient(135deg, #FF9740 0%, #fd7c00 100%);
      color: #fff;
      padding: 18px;
      font-size: 1.8em;
      text-align: center;
      letter-spacing: 1.5px;
      box-shadow: 0 4px 12px rgba(255,151,64,0.3);
      position: relative;
    }
    .logo {
      display: block;
      margin: 15px auto 6px auto;
      max-width: 100px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,.2);
      animation: logoFloat 3s ease-in-out infinite;
    }
    @keyframes logoFloat {
      0%, 100% {transform: translateY(0px);}
      50% {transform: translateY(-8px);}
    }
    main {
      background: #1A1A1A;
      border-radius: 20px;
      max-width: 520px;
      margin: 22px auto;
      box-shadow: 0 10px 40px rgba(255,151,64,0.15);
      padding: 26px 20px;
      position: relative;
      min-height: 700px;
    }
    h2,h3,h4 {color: #FF9740; text-shadow: 0 2px 4px rgba(0,0,0,0.3);}
    .btn {
      background: linear-gradient(135deg, #FF9740 0%, #fd7c00 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 11px 20px;
      font-size: 1.05em;
      cursor: pointer;
      margin:10px 4px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(255,151,64,0.4);
      transition: all .3s ease;
      text-align: center;
      min-width:90px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255,151,64,0.6);
    }
    .btn:active {
      transform: translateY(0px);
    }
    .input-area label {color:#fff;font-weight:600; display:block; margin-top:12px;}
    .input-area input, .input-area select {
      width: 96%; max-width:360px; padding: 10px;
      margin-top:8px;margin-bottom:14px;
      border-radius: 10px; border: 2px solid #FF9740;
      background: #222; color: #FF9740;
      font-size: 1em; outline:none;
      transition: all .3s;
    }
    .input-area input:focus, .input-area select:focus {
      border-color: #fff;
      box-shadow: 0 0 10px rgba(255,151,64,0.5);
    }
    .input-area select {color:#FD7C00;}
    .input-area input[type=file] {color: #fff;}
    .error {color:#ff6b6b;font-weight:600;margin:12px 0; animation: shake 0.5s;}
    @keyframes shake {
      0%, 100% {transform: translateX(0);}
      25% {transform: translateX(-10px);}
      75% {transform: translateX(10px);}
    }
    .success {color:#51cf66;font-weight:600;margin:12px 0;}
    .hidden {display:none !important;}
    #adminBtn {
      position: absolute; left:12px; top:10px;
      font-size:0.85em; background:#222;
      color:#FF9740;border:2px solid #FF9740; z-index:10;
      border-radius:8px; padding:8px 14px; 
      box-shadow: 0 2px 8px rgba(255,151,64,0.4);
      cursor:pointer; font-weight:700;
      transition: all .3s;
    }
    #adminBtn:hover {background:#FF9740;color:#fff;}
    .threeD-bot {
      margin: 16px auto;
      width: 95px; height: 95px; border-radius:50%;
      background: linear-gradient(135deg,#FF9740 0%, #fd7c00 100%);
      box-shadow:0 0 25px rgba(255,151,64,0.6), 0 0 40px rgba(255,151,64,0.3);
      position:relative; display:flex;align-items:center;justify-content:center;
      animation: botFloat 2.8s ease-in-out infinite;
      border: 3px solid #fff;
    }
    @keyframes botFloat {
      0%, 100%{transform: translateY(0px) rotate(0deg);}
      50%{transform: translateY(-12px) rotate(5deg);}
    }
    .threeD-face {
      font-size: 48px; 
      text-shadow:0 3px 8px rgba(0,0,0,0.4);
      user-select:none;
      animation: faceChange 4s ease-in-out infinite;
    }
    @keyframes faceChange {
      0%, 100% {transform: scale(1);}
      50% {transform: scale(1.1);}
    }
    #botSay {
      margin:12px 0; font-size:1.16em; min-height:35px;
      text-align:center; color:#fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      padding:8px;
      background: rgba(255,151,64,0.1);
      border-radius:10px;
    }
    #user-photo {margin:14px auto;max-width:110px;border-radius:50%; 
      box-shadow:0 4px 15px rgba(255,151,64,0.5);
      border:3px solid #FF9740;}
    .nav-icons {
      display:flex; justify-content:space-around; 
      margin:24px 0; flex-wrap:wrap;
    }
    .icon-btn {
      width: 72px; height: 72px; border-radius: 50%;
      font-size: 32px; 
      background: linear-gradient(135deg, #FF9740 0%, #fd7c00 100%);
      color: #fff;
      display: flex; align-items: center; justify-content: center;
      margin:6px; cursor:pointer; font-weight:900; 
      box-shadow:0 4px 12px rgba(255,151,64,0.4);
      transition:all .3s;
      border:3px solid #fff;
      position:relative;
    }
    .icon-btn:hover {
      transform: scale(1.15) rotate(5deg);
      box-shadow:0 6px 20px rgba(255,151,64,0.7);
    }
    .icon-btn:active {
      transform: scale(0.95);
    }
    .progress-bar-container {
      background: #222; margin:18px 0;
      border-radius: 20px; height:28px;
      border:2px solid #FF9740;
      overflow:hidden;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
    }
    .progress-bar-fill {
      background: linear-gradient(90deg,#FF9740 0%, #fff 50%, #FF9740 100%);
      height: 100%; width: 0; 
      color: #111; font-weight: bold;
      text-align: center; font-size:1em; 
      transition:width 0.6s ease;
      line-height:28px;
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }
    #report-section {
      margin-top:18px; padding:16px; 
      background:rgba(255,151,64,0.1);
      border-radius:12px;
      border:2px solid #FF9740;
    }
    #weekly-report {color:#fff; line-height:1.6;}
    #logout-btn {
      background:#222;color:#FF9740; 
      border:2px solid #FF9740;
    }
    #logout-btn:hover{
      background:#FF9740;color:#fff;
    }
    .reqBox {
      margin:12px 0; padding:12px; 
      background:rgba(255,151,64,0.15);
      color:#fff; border-radius:10px;
      border:2px solid #FF9740;
    }
    .adm-panel {margin-top:20px;text-align:center;}
    .adm-list {
      margin:16px 0; padding:10px;
      background:#222; border-radius:10px;
      border:2px solid #FF9740;
    }
    .adm-list-item {
      border-bottom:1px solid #333; 
      padding:10px; color:#fff;
    }
    .adm-list-item:last-child{border:none;}
    .adm-child-data {
      background:rgba(255,151,64,0.2);
      padding:12px; border-radius:12px;
      margin:8px 0; color:#fff;
      border:2px solid #FF9740;
    }
    .back-btn {
      background:#fff;color:#111;
      font-weight:700;
    }
    .back-btn:hover{
      background:#FF9740; color:#fff;
    }
    .req-actions button {margin:4px;}
    .adm-user-label {
      font-weight:700; color:#FF9740;
      cursor:pointer;
    }
    .adm-remove-btn {
      background:#e74c3c;color:white;
    }
    .adm-view-btn {
      background:#3498db;color:white;
    }
    .adm-list-actions {margin-top:8px;}
    .center {text-align:center;}
    
    /* ØµÙØ­Ø§Øª Ø§Ù„Ø£Ù†Ø´Ø·Ø© */
    .activity-page {
      animation: slideIn 0.4s ease;
    }
    @keyframes slideIn {
      from {opacity:0; transform: translateX(-20px);}
      to {opacity:1; transform: translateX(0);}
    }
    .activity-header {
      background: linear-gradient(135deg, #FF9740 0%, #fd7c00 100%);
      padding:14px;
      border-radius:12px;
      color:#fff;
      margin-bottom:16px;
      text-align:center;
      box-shadow: 0 4px 12px rgba(255,151,64,0.4);
    }
    .meal-option, .water-cup, .exercise-card, .mood-card, .sleep-tracker {
      background: rgba(255,151,64,0.1);
      border: 2px solid #FF9740;
      border-radius:12px;
      padding:14px;
      margin:12px 0;
      cursor:pointer;
      transition: all .3s;
      color:#fff;
    }
    .meal-option:hover, .exercise-card:hover, .mood-card:hover {
      background: rgba(255,151,64,0.25);
      transform: translateX(-5px);
      box-shadow: 0 4px 12px rgba(255,151,64,0.5);
    }
    .meal-option.completed, .water-cup.filled, .exercise-card.completed {
      background: rgba(81,207,102,0.3);
      border-color: #51cf66;
    }
    .water-cup {
      width:50px; height:60px;
      display:inline-block;
      margin:8px;
      border-radius:8px;
      background: rgba(255,255,255,0.1);
      border:2px solid #3498db;
      cursor:pointer;
      transition: all .3s;
      position:relative;
    }
    .water-cup.filled {
      background: linear-gradient(180deg, #3498db 0%, #2980b9 100%);
      animation: fillWater 0.5s ease;
    }
    @keyframes fillWater {
      from {transform: scale(0.8);}
      to {transform: scale(1);}
    }
    .exercise-timer {
      font-size:2em;
      color:#FF9740;
      font-weight:bold;
      text-align:center;
      margin:14px 0;
      text-shadow: 0 2px 8px rgba(255,151,64,0.6);
    }
    .mood-emoji {
      font-size:48px;
      margin:8px;
      cursor:pointer;
      transition: all .3s;
      display:inline-block;
    }
    .mood-emoji:hover {
      transform: scale(1.3) rotate(10deg);
    }
    .stars-display {
      text-align:center;
      font-size:1.4em;
      color:#FFD700;
      margin:12px 0;
      text-shadow: 0 2px 8px rgba(255,215,0,0.6);
    }
    .food-emoji {
      font-size:36px;
      display:inline-block;
      margin-right:10px;
    }
  </style>
</head>
<body>
<header>
  <img src="1000365989.jpeg" class="logo" alt="Talevia Logo" />
  Ù„Ø¹Ø¨Ø© Talevia Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©
  <button id="adminBtn" title="Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±">ğŸ” Ø§Ù„Ù…Ø¯ÙŠØ±</button>
</header>
<main>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="login-section">
  <h2 class="center">ğŸŒŸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Talevia</h2>
  <div class="input-area">
    <label>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
    <select id="userType">
      <option value="child">ğŸ‘¦ Ø·ÙÙ„</option>
      <option value="parent">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ ÙˆÙ„ÙŠ Ø£Ù…Ø±</option>
    </select>
    <div id="child-login">
      <label>ğŸ“§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</label>
      <input type="email" id="child-email" placeholder="Ø£Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ" autocomplete="username" />
      <label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
      <input type="password" id="child-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" />
    </div>
    <div id="parent-login" class="hidden">
      <label>ğŸ“§ Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±:</label>
      <input type="email" id="parent-email" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" autocomplete="username" />
      <label>ğŸ‘¦ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø·ÙÙ„:</label>
      <input type="email" id="parent-child-email" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø·ÙÙ„" />
      <label>ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
      <input type="password" id="parent-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" />
    </div>
    <button type="button" class="btn" id="loginBtn">ğŸš€ Ø¯Ø®ÙˆÙ„</button>
    <button type="button" class="btn" id="regBtn">âœ¨ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
    <div class="error" id="login-error"></div>
    <div id="waiting-approval" class="reqBox hidden">
      â³ Ø·Ù„Ø¨Ùƒ ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© TaleviaØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©!
    </div>
  </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¯ÙŠØ± -->
<div id="admin-section" class="hidden">
  <h2 class="center">ğŸ” Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
  <div class="input-area">
    <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±:</label>
    <input type="password" id="admin-password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password" />
    <button type="button" class="btn" id="enter-admin-btn">âœ… ØªØ£ÙƒÙŠØ¯</button>
    <button type="button" class="btn back-btn" id="close-admin-btn">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    <div class="error" id="admin-error"></div>
  </div>
  <div class="adm-panel hidden" id="adm-panel-content">
    <h3 class="center">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
    <div id="adm-req-list" class="adm-list"></div>
    <h3 class="center">ğŸ‘¥ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
    <div id="adm-user-list" class="adm-list"></div>
    <button type="button" class="btn" id="adm-logout-btn">ğŸšª Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="game-section" class="hidden">
  <div class="welcome-msg center" id="welcome-msg"></div>
  <div class="threeD-bot">
    <span class="threeD-face" id="bot-face">ğŸ˜Š</span>
  </div>
  <div id="botSay"></div>
  
  <div class="stars-display">
    â­ Ø§Ù„Ù†Ø¬ÙˆÙ…: <span id="stars-count">0</span> | ğŸ† Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="points-count">0</span>
  </div>
  
  <label for="upload-photo">ğŸ“· ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©:</label>
  <input type="file" id="upload-photo" accept="image/*" />
  <img id="user-photo" src="" alt="ØµÙˆØ±Ø©" class="hidden" />
  
  <h3 class="center">Ø§Ø®ØªØ± Ù†Ø´Ø§Ø·Ùƒ Ø§Ù„ÙŠÙˆÙ…:</h3>
  <div class="nav-icons" id="main-icons"></div>
  
  <div class="progress-bar-container">
    <div class="progress-bar-fill" id="progress-bar-fill">0%</div>
  </div>
  
  <button id="logout-btn" class="btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ -->
<div id="food-activity" class="hidden activity-page">
  <div class="activity-header">
    <h2>ğŸ¥— Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ</h2>
  </div>
  <h3>Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¬Ø¨Ø©:</h3>
  <div id="meal-selector">
    <div class="meal-option" data-meal="breakfast">
      <span class="food-emoji">ğŸŒ…</span>
      <strong>Ø§Ù„ÙØ·ÙˆØ±</strong>
      <span id="breakfast-status"></span>
    </div>
    <div class="meal-option" data-meal="lunch">
      <span class="food-emoji">â˜€ï¸</span>
      <strong>Ø§Ù„ØºØ¯Ø§Ø¡</strong>
      <span id="lunch-status"></span>
    </div>
    <div class="meal-option" data-meal="dinner">
      <span class="food-emoji">ğŸŒ™</span>
      <strong>Ø§Ù„Ø¹Ø´Ø§Ø¡</strong>
      <span id="dinner-status"></span>
    </div>
  </div>
  <button class="btn back-btn" id="back-from-food">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ¬Ø¨Ø© -->
<div id="meal-details" class="hidden activity-page">
  <div class="activity-header">
    <h2 id="meal-title"></h2>
  </div>
  <h3>Ø§Ø®ØªØ± Ø·Ø¹Ø§Ù…Ùƒ Ø§Ù„ØµØ­ÙŠ:</h3>
  <div id="food-options"></div>
  <button class="btn back-btn" id="back-to-meals">â†©ï¸ Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ¬Ø¨Ø§Øª</button>
</div>

<!-- ØµÙØ­Ø© Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ -->
<div id="water-activity" class="hidden activity-page">
  <div class="activity-header">
    <h2>ğŸ’§ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡</h2>
    <p>Ø§Ù„Ù‡Ø¯Ù: 8 Ø£ÙƒÙˆØ§Ø¨ ÙŠÙˆÙ…ÙŠØ§Ù‹</p>
  </div>
  <div class="center" style="margin:20px 0;">
    <div id="water-cups"></div>
  </div>
  <p class="center" style="color:#fff;">Ø§Ù„Ø£ÙƒÙˆØ§Ø¨ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <span id="water-count">0</span>/8</p>
  <button class="btn back-btn" id="back-from-water">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ -->
<div id="exercise-activity" class="hidden activity-page">
  <div class="activity-header">
    <h2>ğŸƒ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ</h2>
  </div>
  <h3>Ø§Ø®ØªØ± ØªÙ…Ø±ÙŠÙ†Ùƒ:</h3>
  <div id="exercise-list">
    <div class="exercise-card" data-exercise="running">
      <span class="food-emoji">ğŸƒâ€â™‚ï¸</span>
      <strong>Ø§Ù„Ø¬Ø±ÙŠ</strong>
      <p>Ù…Ø¯Ø©: 15 Ø¯Ù‚ÙŠÙ‚Ø©</p>
    </div>
    <div class="exercise-card" data-exercise="swimming">
      <span class="food-emoji">ğŸŠâ€â™‚ï¸</span>
      <strong>Ø§Ù„Ø³Ø¨Ø§Ø­Ø©</strong>
      <p>Ù…Ø¯Ø©: 20 Ø¯Ù‚ÙŠÙ‚Ø©</p>
    </div>
    <div class="exercise-card" data-exercise="yoga">
      <span class="food-emoji">ğŸ§˜</span>
      <strong>Ø§Ù„ÙŠÙˆØ¬Ø§</strong>
      <p>Ù…Ø¯Ø©: 10 Ø¯Ù‚Ø§Ø¦Ù‚</p>
    </div>
    <div class="exercise-card" data-exercise="cycling">
      <span class="food-emoji">ğŸš´</span>
      <strong>Ø±ÙƒÙˆØ¨ Ø§Ù„Ø¯Ø±Ø§Ø¬Ø©</strong>
      <p>Ù…Ø¯Ø©: 25 Ø¯Ù‚ÙŠÙ‚Ø©</p>
    </div>
  </div>
  <button class="btn back-btn" id="back-from-exercise">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ…Ø±ÙŠÙ† -->
<div id="exercise-details" class="hidden activity-page">
  <div class="activity-header">
    <h2 id="exercise-title"></h2>
  </div>
  <div class="exercise-timer" id="exercise-timer">00:00</div>
  <div class="center">
    <button class="btn" id="start-exercise">â–¶ï¸ Ø§Ø¨Ø¯Ø£</button>
    <button class="btn" id="stop-exercise">â¸ï¸ ØªÙˆÙ‚Ù</button>
    <button class="btn" id="complete-exercise">âœ… Ø¥Ù†Ù‡Ø§Ø¡</button>
  </div>
  <button class="btn back-btn" id="back-to-exercises">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± -->
<div id="mood-activity" class="hidden activity-page">
  <div class="activity-header">
    <h2>ğŸ˜Š ÙƒÙŠÙ ØªØ´Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…ØŸ</h2>
  </div>
  <div class="center" style="margin:20px 0;">
    <div class="mood-emoji" data-mood="happy">ğŸ˜Š</div>
    <div class="mood-emoji" data-mood="sad">ğŸ˜¢</div>
    <div class="mood-emoji" data-mood="angry">ğŸ˜ </div>
    <div class="mood-emoji" data-mood="excited">ğŸ¤©</div>
    <div class="mood-emoji" data-mood="tired">ğŸ˜´</div>
    <div class="mood-emoji" data-mood="love">ğŸ˜</div>
  </div>
  <div class="input-area">
    <label>Ø§ÙƒØªØ¨ Ø¹Ù† Ù…Ø´Ø§Ø¹Ø±Ùƒ:</label>
    <input type="text" id="mood-note" placeholder="Ù…Ø§Ø°Ø§ Ø­Ø¯Ø« Ø§Ù„ÙŠÙˆÙ…ØŸ" />
    <button class="btn" id="save-mood">ğŸ’¾ Ø­ÙØ¸</button>
  </div>
  <button class="btn back-btn" id="back-from-mood">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ù†ÙˆÙ… -->
<div id="sleep-activity" class="hidden activity-page">
  <div class="activity-header">
    <h2>ğŸŒ™ Ø§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ</h2>
  </div>
  <div class="sleep-tracker">
    <h3>â° Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©:</h3>
    <input type="number" id="sleep-hours" min="0" max="12" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª" 
           style="width:100px; margin:10px auto; display:block;" />
    <button class="btn" id="save-sleep">ğŸ’¾ Ø­ÙØ¸</button>
  </div>
  <div class="mood-card" style="margin-top:20px;">
    <h3>âœ¨ Ø§Ù„ØªØ£ÙƒÙŠØ¯Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</h3>
    <p id="positive-affirmation" style="font-size:1.2em; color:#fff; text-align:center;"></p>
    <button class="btn" id="new-affirmation">ğŸ”„ ØªØ£ÙƒÙŠØ¯ Ø¬Ø¯ÙŠØ¯</button>
  </div>
  <button class="btn back-btn" id="back-from-sleep">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<!-- ØªÙ‚Ø±ÙŠØ± ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± -->
<div id="report-section" class="hidden">
  <h3 class="center">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…</h3>
  <div id="weekly-report"></div>
</div>

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„ Ù„Ù„Ù…Ø¯ÙŠØ± -->
<div id="adm-child-data-section" class="hidden">
  <h3>ğŸ‘¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„</h3>
  <div class="adm-child-data" id="adm-child-data-content"></div>
  <button type="button" class="btn back-btn" id="back-to-user-list-btn">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

</main>

<script>
// =============== Ø§Ù„Ø«ÙˆØ§Ø¨Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===============
const ADMIN_PASSWORD = "talevia@0800";
const userDBKey = "talevia-users-v2";
const sessionKey = "talevia-session-v2";
const requestKey = "talevia-requests-v2";
const progressKey = "talevia-progress-v2";

let usersDB = JSON.parse(localStorage.getItem(userDBKey)) || [
  {userType:"child",email:"child1@example.com",password:"childpass",parentEmail:"parent1@example.com",
   approved:true,points:0,stars:0,photo:"",name:"Ø§Ù„Ø·ÙÙ„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ"},
  {userType:"parent",email:"parent1@example.com",childEmail:"child1@example.com",
   password:"parentpass",approved:true}
];

let requestsDB = JSON.parse(localStorage.getItem(requestKey)) || [];
let currentUser = null;
let exerciseTimer = null;
let exerciseSeconds = 0;

// Ø§Ù„ØªØ£ÙƒÙŠØ¯Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©
const affirmations = [
  "Ø£Ù†Ø§ Ù‚ÙˆÙŠ ÙˆÙ‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§ÙÙŠ! ğŸ’ª",
  "Ø£Ù†Ø§ Ù…Ø­Ø¨ÙˆØ¨ ÙˆÙ…Ù…ÙŠØ²! â¤ï¸",
  "Ø£Ø³ØªØ·ÙŠØ¹ Ø£Ù† Ø£ØªØ¹Ù„Ù… Ø£ÙŠ Ø´ÙŠØ¡ Ø£Ø±ÙŠØ¯Ù‡! ğŸŒŸ",
  "Ø£Ù†Ø§ Ø£Ø­Ø¨ Ù†ÙØ³ÙŠ ÙˆØ£Ù‡ØªÙ… Ø¨ØµØ­ØªÙŠ! ğŸŒˆ",
  "ÙƒÙ„ ÙŠÙˆÙ… Ø£ØµØ¨Ø­ Ø£ÙØ¶Ù„! âœ¨",
  "Ø£Ù†Ø§ Ø³Ø¹ÙŠØ¯ ÙˆÙ…Ø¨Ø¯Ø¹! ğŸ¨",
  "Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªØºÙ„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª! ğŸš€",
  "Ø£Ù†Ø§ ØµØ¯ÙŠÙ‚ Ø±Ø§Ø¦Ø¹! ğŸ¤—"
];

// Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¹Ø§Ù… Ù„ÙƒÙ„ ÙˆØ¬Ø¨Ø©
const foodOptions = {
  breakfast: [
    {name:"Ø¨ÙŠØ¶ Ù…Ø³Ù„ÙˆÙ‚", emoji:"ğŸ¥š", points:10},
    {name:"Ø´ÙˆÙØ§Ù† Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡", emoji:"ğŸ¥£", points:10},
    {name:"ØªÙˆØ³Øª Ø¨Ø§Ù„Ø£ÙÙˆÙƒØ§Ø¯Ùˆ", emoji:"ğŸ¥‘", points:10},
    {name:"Ø²Ø¨Ø§Ø¯ÙŠ Ø¨Ø§Ù„Ø¹Ø³Ù„", emoji:"ğŸ¯", points:10},
    {name:"ÙÙˆØ§ÙƒÙ‡ Ø·Ø§Ø²Ø¬Ø©", emoji:"ğŸ", points:10}
  ],
  lunch: [
    {name:"Ø³Ù„Ø·Ø© Ø®Ø¶Ø±Ø§Ø¡", emoji:"ğŸ¥—", points:10},
    {name:"Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ", emoji:"ğŸ—", points:10},
    {name:"Ø£Ø±Ø² Ø¨Ù†ÙŠ", emoji:"ğŸš", points:10},
    {name:"Ø³Ù…Ùƒ Ù…Ø´ÙˆÙŠ", emoji:"ğŸŸ", points:10},
    {name:"Ø®Ø¶Ø§Ø± Ù…Ø·Ø¨ÙˆØ®Ø©", emoji:"ğŸ¥¦", points:10}
  ],
  dinner: [
    {name:"Ø´ÙˆØ±Ø¨Ø© Ø®Ø¶Ø§Ø±", emoji:"ğŸ²", points:10},
    {name:"Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ØµØ­ÙŠ", emoji:"ğŸ¥ª", points:10},
    {name:"Ù…Ø¹ÙƒØ±ÙˆÙ†Ø© Ø¨Ø§Ù„Ø®Ø¶Ø§Ø±", emoji:"ğŸ", points:10},
    {name:"Ø³Ù„Ø·Ø© ÙÙˆØ§ÙƒÙ‡", emoji:"ğŸ¥—", points:10},
    {name:"Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø©", emoji:"ğŸ«˜", points:10}
  ]
};

// =============== Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===============
function saveUsersDB(){localStorage.setItem(userDBKey,JSON.stringify(usersDB));}
function saveRequestsDB(){localStorage.setItem(requestKey,JSON.stringify(requestsDB));}
function saveProgress(data){localStorage.setItem(progressKey,JSON.stringify(data));}
function loadProgress(){return JSON.parse(localStorage.getItem(progressKey)) || {};}
function saveSession(user){localStorage.setItem(sessionKey,JSON.stringify(user));}
function loadSession(){
  let sess=localStorage.getItem(sessionKey);
  return sess ? JSON.parse(sess) : null;
}

// =============== Ø§Ù„Ø¹Ù†Ø§ØµØ± ===============
const adminBtn=document.getElementById("adminBtn");
const adminSection=document.getElementById("admin-section");
const admPanelContent=document.getElementById("adm-panel-content");
const loginSection=document.getElementById("login-section");
const gameSection=document.getElementById("game-section");
const foodActivity=document.getElementById("food-activity");
const mealDetails=document.getElementById("meal-details");
const waterActivity=document.getElementById("water-activity");
const exerciseActivity=document.getElementById("exercise-activity");
const exerciseDetails=document.getElementById("exercise-details");
const moodActivity=document.getElementById("mood-activity");
const sleepActivity=document.getElementById("sleep-activity");
const reportSection=document.getElementById("report-section");

// =============== Ø§Ù„Ø¨ÙˆØª ===============
function botSetFace(emotion){
  const faces={happy:"ğŸ˜Š",excited:"ğŸ‰",encouraging:"ğŸ’ª",proud:"ğŸ‘",sad:"ğŸ˜”",neutral:"ğŸ™‚"};
  document.getElementById("bot-face").textContent=faces[emotion]||faces.neutral;
}

function botSpeak(text,emotion="happy"){
  botSetFace(emotion);
  const botSay=document.getElementById("botSay");
  botSay.textContent="";
  let idx=0;
  function typeWriter(){
    if(idx<text.length){
      botSay.textContent+=text.charAt(idx);
      idx++;
      setTimeout(typeWriter,30);
    }
  }
  typeWriter();
}

// =============== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ===============
document.getElementById("userType").addEventListener("change",(e)=>{
  const val=e.target.value;
  document.getElementById("child-login").classList.toggle("hidden",val!=="child");
  document.getElementById("parent-login").classList.toggle("hidden",val!=="parent");
  document.getElementById("login-error").textContent="";
});

document.getElementById("regBtn").addEventListener("click",()=>{
  const type=document.getElementById("userType").value;
  let email,password,name="";
  
  if(type==="child"){
    email=document.getElementById("child-email").value.trim().toLowerCase();
    password=document.getElementById("child-password").value;
    name=email.split('@')[0];
    
    if(usersDB.some(u=>u.email===email)||requestsDB.some(r=>r.email===email)){
      document.getElementById("login-error").textContent="âš ï¸ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!";
      return;
    }
    requestsDB.push({userType:"child",email,password,name,approved:false,points:0,stars:0});
  }else{
    email=document.getElementById("parent-email").value.trim().toLowerCase();
    const childEmail=document.getElementById("parent-child-email").value.trim().toLowerCase();
    password=document.getElementById("parent-password").value;
    name=email.split('@')[0];
    
    if(usersDB.some(u=>u.email===email)||requestsDB.some(r=>r.email===email)){
      document.getElementById("login-error").textContent="âš ï¸ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!";
      return;
    }
    requestsDB.push({userType:"parent",email,password,childEmail,name,approved:false});
  }
  
  saveRequestsDB();
  document.getElementById("waiting-approval").classList.remove("hidden");
  document.getElementById("login-error").textContent="";
});

document.getElementById("loginBtn").addEventListener("click",()=>{
  const type=document.getElementById("userType").value;
  let email,password;
  
  if(type==="child"){
    email=document.getElementById("child-email").value.trim().toLowerCase();
    password=document.getElementById("child-password").value;
    let user=usersDB.find(u=>u.email===email&&u.userType==="child");
    
    if(!user){
      document.getElementById("login-error").textContent="âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!";
      return;
    }
    if(user.password!==password){
      document.getElementById("login-error").textContent="âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!";
      return;
    }
    
    currentUser=user;
    saveSession(currentUser);
    showGameInterface(user);
  }else{
    email=document.getElementById("parent-email").value.trim().toLowerCase();
    const childEmail=document.getElementById("parent-child-email").value.trim().toLowerCase();
    password=document.getElementById("parent-password").value;
    let user=usersDB.find(u=>u.email===email&&u.userType==="parent");
    
    if(!user||user.password!==password||user.childEmail!==childEmail){
      document.getElementById("login-error").textContent="âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©!";
      return;
    }
    
    currentUser=user;
    saveSession(currentUser);
    showGameInterface(user);
    showReport();
  }
});

document.getElementById("logout-btn").addEventListener("click",()=>{
  currentUser=null;
  localStorage.removeItem(sessionKey);
  hideAllSections();
  loginSection.classList.remove("hidden");
});

// =============== Ø§Ù„Ù…Ø¯ÙŠØ± ===============
adminBtn.addEventListener("click",()=>{
  hideAllSections();
  adminSection.classList.remove("hidden");
});

document.getElementById("close-admin-btn").addEventListener("click",()=>{
  hideAllSections();
  loginSection.classList.remove("hidden");
});

document.getElementById("enter-admin-btn").addEventListener("click",()=>{
  const pass=document.getElementById("admin-password").value;
  if(pass!==ADMIN_PASSWORD){
    document.getElementById("admin-error").textContent="âš ï¸ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!";
    return;
  }
  admPanelContent.classList.remove("hidden");
  loadAdminLists();
});

document.getElementById("adm-logout-btn").addEventListener("click",()=>{
  hideAllSections();
  loginSection.classList.remove("hidden");
});

function loadAdminLists(){
  // Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  const admReqList=document.getElementById("adm-req-list");
  admReqList.innerHTML="";
  const reqs=requestsDB.filter(r=>!r.approved);
  
  if(reqs.length===0){
    admReqList.innerHTML="<p class='center'>âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>";
  }else{
    reqs.forEach((r,i)=>{
      const div=document.createElement("div");
      div.className="adm-list-item";
      div.innerHTML=`
        <span class="adm-user-label">${r.name} (${r.email})</span>
        <div class="adm-list-actions">
          <button class="btn" onclick="approveReq(${i})">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>
          <button class="btn adm-remove-btn" onclick="rejectReq(${i})">âŒ Ø±ÙØ¶</button>
        </div>
      `;
      admReqList.appendChild(div);
    });
  }
  
  // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
  const admUserList=document.getElementById("adm-user-list");
  admUserList.innerHTML="";
  usersDB.forEach((u,idx)=>{
    const div=document.createElement("div");
    div.className="adm-list-item";
    div.innerHTML=`
      <span class="adm-user-label" onclick="showChildData(${idx})">${u.name||u.email}</span>
      <div class="adm-list-actions">
        <button class="btn adm-view-btn" onclick="showChildData(${idx})">ğŸ‘ï¸ Ø¹Ø±Ø¶</button>
        <button class="btn adm-remove-btn" onclick="removeUser(${idx})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>
    `;
    admUserList.appendChild(div);
  });
}

window.approveReq=function(idx){
  const req=requestsDB[idx];
  usersDB.push({...req,approved:true});
  requestsDB.splice(idx,1);
  saveUsersDB();
  saveRequestsDB();
  loadAdminLists();
};

window.rejectReq=function(idx){
  requestsDB.splice(idx,1);
  saveRequestsDB();
  loadAdminLists();
};

window.removeUser=function(idx){
  usersDB.splice(idx,1);
  saveUsersDB();
  loadAdminLists();
};

window.showChildData=function(idx){
  const user=usersDB[idx];
  admPanelContent.classList.add("hidden");
  document.getElementById("adm-child-data-section").classList.remove("hidden");
  
  const content=document.getElementById("adm-child-data-content");
  content.innerHTML=`
    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${user.name||user.email}</p>
    <p><strong>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</strong> ${user.email}</p>
    <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${user.userType==="child"?"Ø·ÙÙ„":"ÙˆÙ„ÙŠ Ø£Ù…Ø±"}</p>
    ${user.userType==="child"?`
      <p><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${user.points||0}</p>
      <p><strong>Ø§Ù„Ù†Ø¬ÙˆÙ…:</strong> ${user.stars||0}</p>
      <p><strong>Ø§Ù„ØªÙ‚Ø¯Ù…:</strong> ${Math.min(100,Math.floor((user.points||0)/100*100))}%</p>
    `:""}
  `;
};

document.getElementById("back-to-user-list-btn").addEventListener("click",()=>{
  document.getElementById("adm-child-data-section").classList.add("hidden");
  admPanelContent.classList.remove("hidden");
});

// =============== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ===============
function showGameInterface(user){
  hideAllSections();
  gameSection.classList.remove("hidden");
  
  document.getElementById("welcome-msg").textContent=`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name||user.email}! ğŸ‰`;
  botSpeak(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${user.name||user.email}! Ø£Ù†Ø§ ØµØ¯ÙŠÙ‚Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø±Ø­Ù„Ø© Ø§Ù„ØµØ­Ø©! ğŸŒŸ`,"excited");
  
  updateStats();
  loadMainIcons();
  
  if(user.photo){
    document.getElementById("user-photo").src=user.photo;
    document.getElementById("user-photo").classList.remove("hidden");
  }
}

function updateStats(){
  if(!currentUser) return;
  document.getElementById("stars-count").textContent=currentUser.stars||0;
  document.getElementById("points-count").textContent=currentUser.points||0;
  
  const percent=Math.min(100,Math.floor(((currentUser.points||0)/100)*100));
  const fill=document.getElementById("progress-bar-fill");
  fill.style.width=percent+"%";
  fill.textContent=percent+"%";
}

function loadMainIcons(){
  const activities=[
    {name:"Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ",emoji:"ğŸ¥—",id:"food"},
    {name:"Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡",emoji:"ğŸ’§",id:"water"},
    {name:"Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ",emoji:"ğŸƒ",id:"exercise"},
    {name:"Ø§Ù„Ù…Ø´Ø§Ø¹Ø±",emoji:"ğŸ˜Š",id:"mood"},
    {name:"Ø§Ù„Ù†ÙˆÙ…",emoji:"ğŸŒ™",id:"sleep"}
  ];
  
  const container=document.getElementById("main-icons");
  container.innerHTML="";
  
  activities.forEach(a=>{
    const btn=document.createElement("div");
    btn.className="icon-btn";
    btn.textContent=a.emoji;
    btn.title=a.name;
    btn.onclick=()=>openActivity(a.id);
    container.appendChild(btn);
  });
}

function openActivity(id){
  hideAllSections();
  
  switch(id){
    case "food":
      foodActivity.classList.remove("hidden");
      loadMealStatus();
      break;
    case "water":
      waterActivity.classList.remove("hidden");
      loadWaterCups();
      break;
    case "exercise":
      exerciseActivity.classList.remove("hidden");
      break;
    case "mood":
      moodActivity.classList.remove("hidden");
      break;
    case "sleep":
      sleepActivity.classList.remove("hidden");
      loadSleepData();
      break;
  }
}

function hideAllSections(){
  [loginSection,adminSection,gameSection,foodActivity,mealDetails,
   waterActivity,exerciseActivity,exerciseDetails,moodActivity,
   sleepActivity,reportSection,document.getElementById("adm-child-data-section"),
   admPanelContent].forEach(el=>el.classList.add("hidden"));
}

// =============== Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ ===============
function loadMealStatus(){
  const progress=loadProgress();
  const today=new Date().toDateString();
  const todayProgress=progress[currentUser.email]?.[today]||{};
  
  ["breakfast","lunch","dinner"].forEach(meal=>{
    const status=document.getElementById(`${meal}-status`);
    if(todayProgress[meal]){
      status.textContent=" âœ…";
      document.querySelector(`[data-meal="${meal}"]`).classList.add("completed");
    }else{
      status.textContent="";
      document.querySelector(`[data-meal="${meal}"]`).classList.remove("completed");
    }
  });
}

document.querySelectorAll(".meal-option").forEach(opt=>{
  opt.addEventListener("click",function(){
    const meal=this.dataset.meal;
    const progress=loadProgress();
    const today=new Date().toDateString();
    const todayProgress=progress[currentUser.email]?.[today]||{};
    
    if(todayProgress[meal]){
      botSpeak("Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¬Ø¨Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ…! ğŸ˜Š","encouraging");
      return;
    }
    
    openMealDetails(meal);
  });
});

function openMealDetails(meal){
  foodActivity.classList.add("hidden");
  mealDetails.classList.remove("hidden");
  
  const titles={breakfast:"ğŸŒ… Ø§Ù„ÙØ·ÙˆØ±",lunch:"â˜€ï¸ Ø§Ù„ØºØ¯Ø§Ø¡",dinner:"ğŸŒ™ Ø§Ù„Ø¹Ø´Ø§Ø¡"};
  document.getElementById("meal-title").textContent=titles[meal];
  
  const container=document.getElementById("food-options");
  container.innerHTML="";
  
  foodOptions[meal].forEach(food=>{
    const div=document.createElement("div");
    div.className="meal-option";
    div.innerHTML=`
      <span class="food-emoji">${food.emoji}</span>
      <strong>${food.name}</strong>
      <span style="color:#FFD700;"> +${food.points} Ù†Ù‚Ø§Ø·</span>
    `;
    div.onclick=()=>selectFood(meal,food);
    container.appendChild(div);
  });
}

function selectFood(meal,food){
  const progress=loadProgress();
  const today=new Date().toDateString();
  
  if(!progress[currentUser.email]) progress[currentUser.email]={};
  if(!progress[currentUser.email][today]) progress[currentUser.email][today]={};
  
  if(progress[currentUser.email][today][meal]){
    botSpeak("Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª Ø·Ø¹Ø§Ù…Ø§Ù‹ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¬Ø¨Ø© Ø¨Ø§Ù„ÙØ¹Ù„! ğŸ½ï¸","encouraging");
    return;
  }
  
  progress[currentUser.email][today][meal]=food.name;
  saveProgress(progress);
  
  currentUser.points=(currentUser.points||0)+food.points;
  currentUser.stars=(currentUser.stars||0)+1;
  
  const idx=usersDB.findIndex(u=>u.email===currentUser.email);
  if(idx!==-1){
    usersDB[idx]=currentUser;
    saveUsersDB();
  }
  saveSession(currentUser);
  
  botSpeak(`Ø±Ø§Ø¦Ø¹! Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª ${food.name}! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${food.points} Ù†Ù‚Ø§Ø·! ğŸŒŸ`,"excited");
  updateStats();
  
  setTimeout(()=>{
    mealDetails.classList.add("hidden");
    foodActivity.classList.remove("hidden");
    loadMealStatus();
  },2000);
}

document.getElementById("back-from-food").onclick=()=>{
  foodActivity.classList.add("hidden");
  gameSection.classList.remove("hidden");
};

document.getElementById("back-to-meals").onclick=()=>{
  mealDetails.classList.add("hidden");
  foodActivity.classList.remove("hidden");
};

// =============== Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ ===============
function loadWaterCups(){
  const progress=loadProgress();
  const today=new Date().toDateString();
  const waterCount=(progress[currentUser.email]?.[today]?.water||0);
  
  const container=document.getElementById("water-cups");
  container.innerHTML="";
  
  for(let i=0;i<8;i++){
    const cup=document.createElement("div");
    cup.className="water-cup";
    if(i<waterCount) cup.classList.add("filled");
    cup.onclick=()=>drinkWater(i+1);
    container.appendChild(cup);
  }
  
  document.getElementById("water-count").textContent=waterCount;
}

function drinkWater(cupNum){
  const progress=loadProgress();
  const today=new Date().toDateString();
  
  if(!progress[currentUser.email]) progress[currentUser.email]={};
  if(!progress[currentUser.email][today]) progress[currentUser.email][today]={};
  
  const currentCount=progress[currentUser.email][today].water||0;
  
  if(cupNum>currentCount){
    progress[currentUser.email][today].water=cupNum;
    saveProgress(progress);
    
    currentUser.points=(currentUser.points||0)+2;
    currentUser.stars=(currentUser.stars||0)+1;
    
    const idx=usersDB.findIndex(u=>u.email===currentUser.email);
    if(idx!==-1){
      usersDB[idx]=currentUser;
      saveUsersDB();
    }
    saveSession(currentUser);
    
    botSpeak(`Ø£Ø­Ø³Ù†Øª! Ø´Ø±Ø¨Øª ÙƒÙˆØ¨ Ù…Ø§Ø¡ Ø±Ù‚Ù… ${cupNum}! ğŸ’§`,"happy");
    updateStats();
    loadWaterCups();
  }
}

document.getElementById("back-from-water").onclick=()=>{
  waterActivity.classList.add("hidden");
  gameSection.classList.remove("hidden");
};

// =============== Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ ===============
document.querySelectorAll(".exercise-card").forEach(card=>{
  card.addEventListener("click",function(){
    const exercise=this.dataset.exercise;
    const progress=loadProgress();
    const today=new Date().toDateString();
    const todayProgress=progress[currentUser.email]?.[today]||{};
    
    if(todayProgress[`exercise_${exercise}`]){
      botSpeak("Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ø§ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…! Ø¬Ø±Ø¨ ØªÙ…Ø±ÙŠÙ†Ø§Ù‹ Ø¢Ø®Ø±! ğŸ’ª","encouraging");
      return;
    }
    
    openExerciseDetails(exercise,this.querySelector("strong").textContent);
  });
});

function openExerciseDetails(exercise,title){
  exerciseActivity.classList.add("hidden");
  exerciseDetails.classList.remove("hidden");
  
  document.getElementById("exercise-title").textContent=title;
  document.getElementById("exercise-timer").textContent="00:00";
  exerciseSeconds=0;
  
  document.getElementById("start-exercise").onclick=()=>startExercise();
  document.getElementById("stop-exercise").onclick=()=>stopExercise();
  document.getElementById("complete-exercise").onclick=()=>completeExercise(exercise);
}

function startExercise(){
  if(exerciseTimer) return;
  
  exerciseTimer=setInterval(()=>{
    exerciseSeconds++;
    const mins=Math.floor(exerciseSeconds/60);
    const secs=exerciseSeconds%60;
    document.getElementById("exercise-timer").textContent=
      `${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
  },1000);
  
  botSpeak("Ø±Ø§Ø¦Ø¹! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ…Ø±ÙŠÙ†! ğŸ’ª","encouraging");
}

function stopExercise(){
  if(exerciseTimer){
    clearInterval(exerciseTimer);
    exerciseTimer=null;
  }
}

function completeExercise(exercise){
  stopExercise();
  
  if(exerciseSeconds<60){
    botSpeak("Ø­Ø§ÙˆÙ„ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„! ğŸ˜Š","encouraging");
    return;
  }
  
  const progress=loadProgress();
  const today=new Date().toDateString();
  
  if(!progress[currentUser.email]) progress[currentUser.email]={};
  if(!progress[currentUser.email][today]) progress[currentUser.email][today]={};
  
  progress[currentUser.email][today][`exercise_${exercise}`]=true;
  saveProgress(progress);
  
  const points=Math.floor(exerciseSeconds/60)*5;
  currentUser.points=(currentUser.points||0)+points;
  currentUser.stars=(currentUser.stars||0)+2;
  
  const idx=usersDB.findIndex(u=>u.email===currentUser.email);
  if(idx!==-1){
    usersDB[idx]=currentUser;
    saveUsersDB();
  }
  saveSession(currentUser);
  
  botSpeak(`Ù…Ù…ØªØ§Ø²! Ø£ÙƒÙ…Ù„Øª ${Math.floor(exerciseSeconds/60)} Ø¯Ù‚ÙŠÙ‚Ø©! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${points} Ù†Ù‚Ø·Ø©! ğŸ†`,"proud");
  updateStats();
  
  setTimeout(()=>{
    exerciseDetails.classList.add("hidden");
    exerciseActivity.classList.remove("hidden");
  },2000);
}

document.getElementById("back-from-exercise").onclick=()=>{
  exerciseActivity.classList.add("hidden");
  gameSection.classList.remove("hidden");
};

document.getElementById("back-to-exercises").onclick=()=>{
  stopExercise();
  exerciseDetails.classList.add("hidden");
  exerciseActivity.classList.remove("hidden");
};

// =============== Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ===============
document.querySelectorAll(".mood-emoji").forEach(emoji=>{
  emoji.addEventListener("click",function(){
    const mood=this.dataset.mood;
    document.getElementById("mood-note").value=`Ø´Ø¹Ø±Øª Ø¨Ù€ ${mood} Ø§Ù„ÙŠÙˆÙ…!`;
  });
});

document.getElementById("save-mood").onclick=()=>{
  const note=document.getElementById("mood-note").value;
  if(!note){
    botSpeak("Ø§ÙƒØªØ¨ Ø´ÙŠØ¦Ø§Ù‹ Ø¹Ù† Ù…Ø´Ø§Ø¹Ø±Ùƒ Ø£ÙˆÙ„Ø§Ù‹! ğŸ˜Š","encouraging");
    return;
  }
  
  const progress=loadProgress();
  const today=new Date().toDateString();
  
  if(!progress[currentUser.email]) progress[currentUser.email]={};
  if(!progress[currentUser.email][today]) progress[currentUser.email][today]={};
  
  if(progress[currentUser.email][today].mood){
    botSpeak("Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ù…Ø´Ø§Ø¹Ø±Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„! ğŸ˜Š","happy");
    return;
  }
  
  progress[currentUser.email][today].mood=note;
  saveProgress(progress);
  
  currentUser.points=(currentUser.points||0)+5;
  currentUser.stars=(currentUser.stars||0)+1;
  
  const idx=usersDB.findIndex(u=>u.email===currentUser.email);
  if(idx!==-1){
    usersDB[idx]=currentUser;
    saveUsersDB();
  }
  saveSession(currentUser);
  
  botSpeak("Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø´Ø§Ø¹Ø±Ùƒ! Ø£Ù†Øª Ø±Ø§Ø¦Ø¹! â¤ï¸","happy");
  updateStats();
  document.getElementById("mood-note").value="";
};

document.getElementById("back-from-mood").onclick=()=>{
  moodActivity.classList.add("hidden");
  gameSection.classList.remove("hidden");
};

// =============== Ø§Ù„Ù†ÙˆÙ… ===============
function loadSleepData(){
  document.getElementById("positive-affirmation").textContent=
    affirmations[Math.floor(Math.random()*affirmations.length)];
}

document.getElementById("save-sleep").onclick=()=>{
  const hours=parseInt(document.getElementById("sleep-hours").value);
  
  if(!hours||hours<1){
    botSpeak("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…! ğŸŒ™","encouraging");
    return;
  }
  
  const progress=loadProgress();
  const today=new Date().toDateString();
  
  if(!progress[currentUser.email]) progress[currentUser.email]={};
  if(!progress[currentUser.email][today]) progress[currentUser.email][today]={};
  
  if(progress[currentUser.email][today].sleep){
    botSpeak("Ù„Ù‚Ø¯ Ø³Ø¬Ù„Øª Ù†ÙˆÙ…Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„! ğŸ˜´","happy");
    return;
  }
  
  progress[currentUser.email][today].sleep=hours;
  saveProgress(progress);
  
  let points=hours>=8?15:hours>=6?10:5;
  currentUser.points=(currentUser.points||0)+points;
  currentUser.stars=(currentUser.stars||0)+1;
  
  const idx=usersDB.findIndex(u=>u.email===currentUser.email);
  if(idx!==-1){
    usersDB[idx]=currentUser;
    saveUsersDB();
  }
  saveSession(currentUser);
  
  botSpeak(hours>=8?
    "Ù…Ù…ØªØ§Ø²! Ù†Ù…Øª Ø¨Ø´ÙƒÙ„ ÙƒØ§ÙÙ! ğŸŒŸ":"Ø­Ø§ÙˆÙ„ Ø§Ù„Ù†ÙˆÙ… 8 Ø³Ø§Ø¹Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø£ÙƒØ«Ø±! ğŸ˜Š","happy");
  updateStats();
  document.getElementById("sleep-hours").value="";
};

document.getElementById("new-affirmation").onclick=()=>{
  document.getElementById("positive-affirmation").textContent=
    affirmations[Math.floor(Math.random()*affirmations.length)];
};

document.getElementById("back-from-sleep").onclick=()=>{
  sleepActivity.classList.add("hidden");
  gameSection.classList.remove("hidden");
};

// =============== Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ===============
document.getElementById("upload-photo").addEventListener("change",function(){
  const file=this.files[0];
  if(!file) return;
  
  const reader=new FileReader();
  reader.onload=e=>{
    document.getElementById("user-photo").src=e.target.result;
    document.getElementById("user-photo").classList.remove("hidden");
    
    currentUser.photo=e.target.result;
    const idx=usersDB.findIndex(u=>u.email===currentUser.email);
    if(idx!==-1){
      usersDB[idx].photo=currentUser.photo;
      saveUsersDB();
    }
    saveSession(currentUser);
  };
  reader.readAsDataURL(file);
});

// =============== ØªÙ‚Ø±ÙŠØ± ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ===============
function showReport(){
  if(currentUser.userType!=="parent") return;
  
  reportSection.classList.remove("hidden");
  const child=usersDB.find(u=>u.email===currentUser.childEmail&&u.userType==="child");
  
  if(!child){
    document.getElementById("weekly-report").innerHTML="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·ÙÙ„.";
    return;
  }
  
  document.getElementById("weekly-report").innerHTML=`
    <p><strong>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„:</strong> ${child.name||child.email}</p>
    <p><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${child.points||0} ğŸ†</p>
    <p><strong>Ø§Ù„Ù†Ø¬ÙˆÙ…:</strong> ${child.stars||0} â­</p>
    <p><strong>Ø§Ù„ØªÙ‚Ø¯Ù…:</strong> ${Math.min(100,Math.floor((child.points||0)))}%</p>
    <p style="color:#51cf66;">Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø¯Ø¹Ù… Ø·ÙÙ„Ùƒ! â¤ï¸</p>
  `;
}

// =============== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===============
window.addEventListener("load",()=>{
  const savedUser=loadSession();
  if(savedUser){
    currentUser=savedUser;
    // ØªØ­Ø¯ÙŠØ« Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const idx=usersDB.findIndex(u=>u.email===savedUser.email&&u.userType===savedUser.userType);
    if(idx!==-1) currentUser=usersDB[idx];
    showGameInterface(currentUser);
    if(currentUser.userType==="parent") showReport();
  }
});
</script>
</body>
</html>
